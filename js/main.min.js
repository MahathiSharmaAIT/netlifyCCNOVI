const debounce = (e, t) => {
    let n;
    return function (...r) {
      clearTimeout(n), (n = setTimeout(() => e(...r), t));
    };
  },
  throttle = (e, t) => {
    let n;
    return function () {
      const r = arguments,
        o = this;
      n || (e.apply(o, r), (n = !0), setTimeout(() => (n = !1), t));
    };
  },
  domReady = (e) => {
    "loading" === document.readyState
      ? document.addEventListener("DOMContentLoaded", e)
      : e();
  },
  initHeaderScroll = () => {
    const e = document.getElementById("header");
    if (!e) return;
    const t = throttle(() => {
      e.classList.toggle("scrolled", window.scrollY > 100);
    }, 16);
    window.addEventListener("scroll", t, { passive: !0 });
  },
  initMobileMenu = () => {
    const e = document.querySelector(".mobile-menu-toggle"),
      t = document.querySelector(".nav-menu");
    if (!e || !t) return;
    e.addEventListener("click", (n) => {
      n.preventDefault();
      const r = t.classList.contains("active");
      t.classList.toggle("active"),
        e.classList.toggle("active"),
        (document.body.style.overflow = r ? "" : "hidden");
    }),
      document.querySelectorAll(".nav-menu .dropdown > a").forEach((n) => {
        n.addEventListener("click", (r) => {
          if (window.innerWidth <= 768) {
            r.preventDefault();
            const o = n.parentElement,
              i = o.classList.contains("active");
            document
              .querySelectorAll(".nav-menu .dropdown.active")
              .forEach((e) => {
                e !== o && e.classList.remove("active");
              }),
              o.classList.toggle("active");
          }
        });
      }),
      document.addEventListener("click", (n) => {
        e.contains(n.target) ||
          t.contains(n.target) ||
          (t.classList.remove("active"),
          e.classList.remove("active"),
          (document.body.style.overflow = ""));
      }),
      window.addEventListener(
        "resize",
        debounce(() => {
          window.innerWidth > 768 &&
            (t.classList.remove("active"),
            e.classList.remove("active"),
            (document.body.style.overflow = ""));
        }, 250)
      );
  },
  initSmoothScroll = () => {
    document.querySelectorAll('a[href^="#"]').forEach((e) => {
      e.addEventListener("click", (t) => {
        t.preventDefault();
        const n = e.getAttribute("href"),
          r = document.querySelector(n);
        if (r) {
          const e = document.getElementById("header")?.offsetHeight || 80;
          window.scrollTo({ top: r.offsetTop - e, behavior: "smooth" });
          const t = document.querySelector(".nav-menu"),
            o = document.querySelector(".mobile-menu-toggle");
          t &&
            t.classList.contains("active") &&
            (t.classList.remove("active"),
            o?.classList.remove("active"),
            (document.body.style.overflow = ""));
        }
      });
    });
  },
  initTeamSlider = () => {
    const e = document.querySelector(".team-slider-track"),
      t = document.querySelectorAll(".team-member"),
      n = document.querySelector(".team-nav.next"),
      r = document.querySelector(".team-nav.prev");
    if (!e || !t.length || !n || !r) return;
    let o = 0;
    const i = () => t[0].offsetWidth + 20,
      c = () =>
        Math.floor(
          document.querySelector(".team-slider-container").offsetWidth / i()
        ),
      s = () => Math.max(0, t.length - c()),
      a = () => {
        const t = o * i();
        (e.style.transform = `translateX(-${t}px)`),
          (r.disabled = 0 === o),
          (n.disabled = o >= s());
      };
    n.addEventListener("click", () => {
      o < s() && (o++, a());
    }),
      r.addEventListener("click", () => {
        o > 0 && (o--, a());
      }),
      window.addEventListener(
        "resize",
        debounce(() => {
          (o = Math.min(o, s())), a();
        }, 250)
      ),
      a();
  },
  initServiceModals = () => {
    const e = document.querySelectorAll(".service-learn-more"),
      t = {
        "Collision Repair": {
          description: "Our comprehensive collision repair service includes:",
          features: [
            "Free initial damage assessment",
            "Insurance claim assistance",
            "State-of-the-art repair equipment",
            "Factory-certified technicians",
            "Lifetime warranty on repairs",
            "Free rental car assistance",
          ],
        },
        "Paint Services": {
          description: "Expert paint services featuring:",
          features: [
            "Computerized color matching",
            "Premium quality paints",
            "Clear coat protection",
            "Custom paint jobs",
            "Spot repair and blending",
            "Environmental-friendly products",
          ],
        },
        "HVAC Services": {
          description: "Complete HVAC repairs including:",
          features: [
            "Diagnostics and troubleshooting",
            "Component replacement",
            "System cleaning and maintenance",
            "Refrigerant recharge",
            "Climate control repair",
            "Energy efficiency optimization",
          ],
        },
        "ADAS Calibration": {
          description: "Advanced Driver-Assistance Systems calibration:",
          features: [
            "Camera calibration",
            "Radar sensor alignment",
            "Lane departure warning setup",
            "Collision avoidance system tuning",
            "Parking sensor calibration",
            "Safety compliance verification",
          ],
        },
      };
    e.forEach((e) => {
      e.addEventListener("click", (e) => {
        e.preventDefault();
        const n = e.target
            .closest(".service-card")
            .querySelector("h3")
            .textContent.trim(),
          r = t[n];
        r &&
          ((e, t) => {
            const n = document.createElement("div");
            (n.className = "modal"),
              (n.innerHTML = `<div class="modal-content"><button class="close-modal" aria-label="Close modal">&times;</button><h3>${e}</h3><p>${
                t.description
              }</p><ul>${t.features
                .map((e) => `<li>${e}</li>`)
                .join(
                  ""
                )}</ul><a href="estimate.html" class="btn btn-primary">Get Estimate</a></div>`),
              document.body.appendChild(n),
              requestAnimationFrame(() => {
                n.classList.add("active");
              });
            const r = n.querySelector(".close-modal"),
              o = () => {
                n.classList.remove("active"), setTimeout(() => n.remove(), 300);
              };
            r.addEventListener("click", o),
              n.addEventListener("click", (e) => {
                e.target === n && o();
              });
            const i = (e) => {
              "Escape" === e.key &&
                (o(), document.removeEventListener("keydown", i));
            };
            document.addEventListener("keydown", i);
          })(n, r);
      });
    });
  };
domReady(() => {
  initHeaderScroll(),
    initMobileMenu(),
    initSmoothScroll(),
    initTeamSlider(),
    initServiceModals(),
    "undefined" != typeof AOS &&
      AOS.init({ duration: 600, once: !0, offset: 100 });
});
